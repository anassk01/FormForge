
<!-- src/app/components/workspace/workspace-detail/workspace-detail.component.html -->
<div class="workspace-detail-container">
  @if (loading()) {
    <mat-spinner class="loading-spinner"></mat-spinner>
  } @else {
    @if (workspace()) {
      <mat-card class="workspace-card">
        <mat-card-header>
          <mat-card-title class="workspace-title">{{ workspace()?.name }}</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <form [formGroup]="workspaceForm" (ngSubmit)="onSubmit()">
            <mat-form-field class="form-field">
              <mat-label>Workspace Name</mat-label>
              <input matInput formControlName="name" required>
            </mat-form-field>
            <mat-form-field class="form-field">
              <mat-label>Description</mat-label>
              <textarea matInput formControlName="description" rows="3"></textarea>
            </mat-form-field>
          </form>
          <div class="active-users">
            <h3 class="active-users-title">Active Users</h3>
            <mat-list class="active-users-list">
              @for (user of activeUsers; track user) {
                <mat-list-item>
                  <span matListItemTitle>{{ user }}</span>
                </mat-list-item>
              }
            </mat-list>
          </div>
        </mat-card-content>
        <mat-card-actions class="workspace-actions">
          <button mat-raised-button color="primary" (click)="onSubmit()">Save</button>
          <button mat-raised-button color="warn" (click)="onDelete()">Delete</button>
        </mat-card-actions>
      </mat-card>

      <app-folder-management 
        [workspaceId]="workspace()?._id ?? ''"
        (folderSelected)="onFolderSelected($event)">
      </app-folder-management>

      @if (workspace() && selectedFolderId()) {
        <app-form-management
          [workspaceId]="workspace()?._id ?? ''"
          [folderId]="selectedFolderId()!"
          [selectedForm]="selectedForm()"
          (formSelected)="onFormSelected($event)">
        </app-form-management>
      }

      @if (canManageUsers()) {
        <app-permission-management
          [members]="workspace()?.members ?? []"
          [workspaceId]="workspace()?._id ?? ''"
          (permissionsUpdated)="onPermissionsUpdated()">
        </app-permission-management>
        <app-activity-log [workspaceId]="workspace()?._id ?? ''"></app-activity-log>
      }
    } @else {
      <p class="not-found-message">Workspace not found.</p>
    }
  }
</div>